on:
  push:
    branches: [main]
    paths-ignore:
      - '*.md'
permissions:
  contents: write
jobs:
  test:
    runs-on: ubuntu-latest
    name: Run the action on a test graph and publish
    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Build graph's SPA
        uses: logseq/publish-spa@main
        with:
          graph-directory: .
          theme-mode: dark
          accent-color: green
      - name: Inject custom HTML, CSS and JS
        run: |
          mkdir -p www/custom
          cp custom/custom.css www/custom/ || true
          cp custom/custom.js www/custom/ || true
          
          # Inject CSS for post-processing
          sed -i 's|</head>|<link rel="stylesheet" href="./custom/custom.css"></head>|' www/index.html || true
          
          # Pre-process Spinning Wheel
          sed -i '0,/<body>/s|<body>|<body><div id="loading-screen"><div class="spinner"></div><div class="loading-text">Loading WikiLiteâ€¦</div></div>|' www/index.html || true
          
          # Inject JS for post-processing
          sed -i 's|</body>|<script src="./custom/custom.js"></script></body>|' www/index.html || true

        shell: bash

      - name: Add a nojekyll file
        run: touch $GITHUB_WORKSPACE/www/.nojekyll
      - name: Deploy ðŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: www